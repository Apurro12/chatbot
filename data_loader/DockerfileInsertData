FROM python

RUN apt-get update
# install gcc

# Define the build argument
ARG OPENAI_API_KEY
ARG POSTGRES_DATABASE
ARG POSTGRES_PASSWORD
ARG EMBEDING_COLLECTION_NAME

# Set the environment variable from the build argument
ENV OPENAI_API_KEY=${OPENAI_API_KEY}
ENV POSTGRES_DATABASE=${POSTGRES_DATABASE}
ENV POSTGRES_PASSWORD=${POSTGRES_PASSWORD}
ENV EMBEDING_COLLECTION_NAME=${EMBEDING_COLLECTION_NAME}

RUN pip install langchain
RUN pip install -qU langchain_postgres
RUN pip install -qU langchain-openai
RUN pip install psycopg pandas 

WORKDIR /home

COPY data_loader/01_insert_data.py .
COPY ../utils/utils.py .

# The iarbnb data form Buenos Aires
# You can get it here https://insideairbnb.com/get-the-data/
RUN wget https://data.insideairbnb.com/argentina/ciudad-aut%C3%B3noma-de-buenos-aires/buenos-aires/2024-06-29/data/listings.csv.gz
RUN gzip -d listings.csv.gz 

CMD ["python","01_insert_data.py"]

# Just to dont kill container
# CMD ["tail", "-f", "/dev/null"]